{% extends "base.html" %}

{% block title %}Lista de Programas SENA - SENA APP{% endblock %}

{% block content %}
<!-- Header Section -->
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4">
            <div class="mb-3 mb-md-0">
                <h1 class="display-5 fw-bold mb-2" style="color: #008000;">
                    üéì Lista de Programas de Formaci√≥n
                </h1>
                <p class="lead text-muted mb-0">
                    Todos los programas formativos que ofrece el SENA
                </p>
            </div>
            <div>
                <a href="{% url 'aprendices:inicio' %}" class="back-link">
                    ‚Üê Regresar al Inicio
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Statistics Summary -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="info-item text-center">
            <div class="d-flex align-items-center justify-content-center mb-2">
                <span style="font-size: 1.5rem; margin-right: 10px;">üìä</span>
                <div>
                    <h4 class="mb-0 fw-bold" style="color: #008000;">{{ total_programas }}</h4>
                    <small class="text-muted">Total de Programas</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="info-item text-center">
            <div class="d-flex align-items-center justify-content-center mb-2">
                <span style="font-size: 1.5rem; margin-right: 10px;">üöÄ</span>
                <div>
                    <h4 class="mb-0 fw-bold" style="color: #ff6600;">Activos</h4>
                    <small class="text-muted">Disponibles</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="info-item text-center">
            <div class="d-flex align-items-center justify-content-center mb-2">
                <span style="font-size: 1.5rem; margin-right: 10px;">üìÖ</span>
                <div>
                    <h4 class="mb-0 fw-bold" style="color: #008000;">2025</h4>
                    <small class="text-muted">A√±o Actual</small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main Table Card -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center">
                    <span style="font-size: 1.5rem; margin-right: 15px;">üìã</span>
                    <div>
                        <h5 class="mb-1">Registro de Programas Formativos</h5>
                        <small class="opacity-75">Lista detallada con informaci√≥n de cada programa</small>
                    </div>
                </div>
                <div class="badge badge-sena fs-6 px-3 py-2">
                    {{ total_programas }} registros
                </div>
            </div>
            <div class="card-body p-0">
                {% if lista_programas %}
                    <!-- Campo de b√∫squeda -->
                    <div class="p-3 border-bottom bg-light">
                        <div class="input-group">
                            <span class="input-group-text" style="background: linear-gradient(135deg, #008000 0%, #ff6600 100%); color: white; border: none;">
                                <i class="fas fa-search"></i>
                            </span>
                            <input type="text" class="form-control" id="busquedaProgramas" 
                                   placeholder="Buscar por c√≥digo, nombre, nivel, modalidad, centro..." 
                                   onkeyup="filtrarProgramas()"
                                   style="border-left: none;">
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-striped table-hover mb-0">
                            <thead>
                                <tr>
                                    <th class="text-center" style="width: 100px;">
                                        <i class="fas fa-hashtag"></i> C√≥digo
                                    </th>
                                    <th>
                                        <i class="fas fa-graduation-cap"></i> Programa de Formaci√≥n
                                    </th>
                                    <th>
                                        <i class="fas fa-award"></i> Nivel
                                    </th>
                                    <th>
                                        <i class="fas fa-laptop"></i> Modalidad
                                    </th>
                                    <th>
                                        <i class="fas fa-clock"></i> Duraci√≥n
                                    </th>
                                    <th>
                                        <i class="fas fa-map-marker-alt"></i> Centro/Regional
                                    </th>
                                    <th class="text-center" style="width: 120px;">
                                        <i class="fas fa-cogs"></i> Acciones
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for programa in lista_programas %}
                                <tr>
                                    <td class="text-center fw-bold">
                                        <span class="badge" style="background: linear-gradient(135deg, #008000 0%, #ff6600 100%); color: white; font-size: 0.9rem; padding: 8px 12px;">
                                            {{ programa.codigo }}
                                        </span>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="programa-icon me-3" style="width: 40px; height: 40px; font-size: 1rem; background: linear-gradient(135deg, #008000 0%, #ff6600 100%);">
                                                üéì
                                            </div>
                                            <div>
                                                <div class="fw-bold" style="color: #2d3436;">
                                                    <a href="{% url 'programas:detalle_programa' programa.id %}" class="text-decoration-none" style="color: #008000;">
                                                        {{ programa.nombre }}
                                                    </a>
                                                </div>
                                                <small class="text-muted">
                                                    {{ programa.descripcion|truncatechars:50 }}
                                                </small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge bg-info px-3 py-2">
                                            {{ programa.get_nivel_formacion_display }}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge bg-warning text-dark px-3 py-2">
                                            {{ programa.get_modalidad_display }}
                                        </span>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <span style="color: #ff6600; margin-right: 8px;">‚è±Ô∏è</span>
                                            <div>
                                                <div class="fw-bold" style="color: #008000;">
                                                    {{ programa.duracion_meses }} meses
                                                </div>
                                                <small class="text-muted">{{ programa.duracion_horas }} horas</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <span style="color: #008000; margin-right: 8px;">üè¢</span>
                                            <div>
                                                <div class="fw-semibold text-success">{{ programa.centro_formacion }}</div>
                                                <small class="text-muted">{{ programa.regional }}</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <div class="btn-group" role="group">
                                            <a href="{% url 'programas:detalle_programa' programa.id %}" 
                                               class="btn btn-info btn-sm px-3" 
                                               title="Ver detalles completos">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                            <a href="{% url 'programas:programas_programa_change' programa.pk %}" 
                                               class="btn btn-outline-primary btn-sm" 
                                               title="Editar programa">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <button class="btn btn-outline-info btn-sm" 
                                                    onclick="verModalDetalle('{{ programa.id }}')" 
                                                    title="Vista r√°pida">
                                                <i class="fas fa-search"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <div style="font-size: 6rem; margin-bottom: 20px;">üîç</div>
                        <h4 class="fw-bold mb-3" style="color: #ff6600;">No hay programas registrados</h4>
                        <p class="text-muted mb-4">
                            A√∫n no se han registrado programas de formaci√≥n en el sistema.
                        </p>
                        <a href="{% url 'programas:agregar_programa' %}" class="btn btn-primary btn-lg px-4">
                            <i class="fas fa-plus me-2"></i>Agregar Primer Programa
                        </a>
                    </div>
                {% endif %}
            </div>
            {% if lista_programas %}
            <div class="card-footer bg-light">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <small class="text-muted">
                            <i class="fas fa-info-circle me-1"></i>
                            Mostrando {{ lista_programas|length }} de {{ total_programas }} programas registrados
                        </small>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <small class="text-muted">
                            <i class="fas fa-calendar me-1"></i>
                            √öltima actualizaci√≥n: {% now "d/m/Y H:i" %}
                        </small>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Action Buttons -->
{% if lista_programas %}
<div class="row mt-4">
    <div class="col-12 text-center">
        <div class="d-flex flex-wrap justify-content-center gap-3">
            <a href="{% url 'programas:agregar_programa' %}" class="btn btn-primary btn-lg px-4">
                <i class="fas fa-plus me-2"></i>Agregar Nuevo Programa
            </a>
            <button class="btn btn-success btn-lg px-4" onclick="window.print()">
                <i class="fas fa-print me-2"></i>Imprimir Lista
            </button>
            <a href="{% url 'aprendices:inicio' %}" class="btn btn-secondary btn-lg px-4">
                <i class="fas fa-home me-2"></i>Volver al Inicio
            </a>
        </div>
    </div>
</div>
{% endif %}

<!-- Modal para vista r√°pida del programa -->
<div class="modal fade" id="modalDetalle" tabindex="-1" aria-labelledby="modalDetalleLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <div class="d-flex align-items-center">
                    <span style="font-size: 1.5rem; margin-right: 15px;">üéì</span>
                    <div>
                        <h5 class="modal-title mb-1" id="modalDetalleLabel">Vista R√°pida - Programa</h5>
                        <small class="opacity-75">Datos b√°sicos del programa de formaci√≥n</small>
                    </div>
                </div>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="modalDetalleBody">
                <!-- Los detalles se cargar√°n aqu√≠ din√°micamente -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cerrar
                </button>
                <a href="#" id="btnVerCompleto" class="btn btn-success">
                    <i class="fas fa-eye me-2"></i>Ver Detalles Completos
                </a>
            </div>
        </div>
    </div>
</div>

<script>
function verModalDetalle(programaId) {
    // Buscar el programa en la tabla
    const filas = document.querySelectorAll('tbody tr');
    let programa = null;
    
    filas.forEach(fila => {
        const idCell = fila.querySelector('td .badge');
        if (idCell && idCell.textContent.trim() == programaId) {
            const celdas = fila.querySelectorAll('td');
            programa = {
                id: programaId,
                codigo: idCell.textContent.trim(),
                nombre: celdas[1].querySelector('.fw-bold a').textContent.trim(),
                descripcion: celdas[1].querySelector('small').textContent.trim(),
                nivel: celdas[2].querySelector('.badge').textContent.trim(),
                modalidad: celdas[3].querySelector('.badge').textContent.trim(),
                duracion_meses: celdas[4].querySelector('.fw-bold').textContent.trim(),
                duracion_horas: celdas[4].querySelector('small').textContent.trim(),
                centro: celdas[5].querySelector('.fw-semibold').textContent.trim(),
                regional: celdas[5].querySelector('small').textContent.trim()
            };
        }
    });
    
    if (programa) {
        // Actualizar el enlace "Ver Detalles Completos"
        document.getElementById('btnVerCompleto').href = `/programa/${programa.id}/`;
        
        document.getElementById('modalDetalleBody').innerHTML = `
            <div class="row">
                <div class="col-md-4 text-center mb-4">
                    <div class="programa-icon mx-auto mb-3" style="width: 100px; height: 100px; font-size: 2.5rem;">
                        üéì
                    </div>
                    <h5 class="fw-bold" style="color: #008000;">C√≥digo: ${programa.codigo}</h5>
                    <p class="text-muted mb-0">${programa.nivel}</p>
                </div>
                <div class="col-md-8">
                    <div class="info-item">
                        <div class="row mb-3">
                            <div class="col-sm-4">
                                <strong style="color: #ff6600;">
                                    üéì Nombre:
                                </strong>
                            </div>
                            <div class="col-sm-8">
                                <span class="fw-semibold">${programa.nombre}</span>
                            </div>
                        </div>
                        <hr style="border-color: #008000; opacity: 0.3;">
                        
                        <div class="row mb-3">
                            <div class="col-sm-4">
                                <strong style="color: #ff6600;">
                                    üìù Descripci√≥n:
                                </strong>
                            </div>
                            <div class="col-sm-8">
                                <span>${programa.descripcion}</span>
                            </div>
                        </div>
                        <hr style="border-color: #008000; opacity: 0.3;">
                        
                        <div class="row mb-3">
                            <div class="col-sm-4">
                                <strong style="color: #ff6600;">
                                    üèÜ Nivel Formaci√≥n:
                                </strong>
                            </div>
                            <div class="col-sm-8">
                                <span class="badge bg-info px-3 py-2">${programa.nivel}</span>
                            </div>
                        </div>
                        <hr style="border-color: #008000; opacity: 0.3;">
                        
                        <div class="row mb-3">
                            <div class="col-sm-4">
                                <strong style="color: #ff6600;">
                                    üíª Modalidad:
                                </strong>
                            </div>
                            <div class="col-sm-8">
                                <span class="badge bg-warning text-dark px-3 py-2">${programa.modalidad}</span>
                            </div>
                        </div>
                        <hr style="border-color: #008000; opacity: 0.3;">
                        
                        <div class="row mb-3">
                            <div class="col-sm-4">
                                <strong style="color: #ff6600;">
                                    ‚è±Ô∏è Duraci√≥n:
                                </strong>
                            </div>
                            <div class="col-sm-8">
                                <span class="fw-bold" style="color: #008000;">${programa.duracion_meses}</span>
                                <br><small class="text-muted">${programa.duracion_horas}</small>
                            </div>
                        </div>
                        <hr style="border-color: #008000; opacity: 0.3;">
                        
                        <div class="row mb-0">
                            <div class="col-sm-4">
                                <strong style="color: #ff6600;">
                                    üè¢ Centro:
                                </strong>
                            </div>
                            <div class="col-sm-8">
                                <span class="fw-semibold text-success">${programa.centro}</span>
                                <br><small class="text-muted">${programa.regional}</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row mt-4">
                <div class="col-12">
                    <div class="alert" style="background: rgba(0, 128, 0, 0.1); border-left: 4px solid #008000;">
                        <div class="d-flex align-items-center">
                            <span style="color: #008000; margin-right: 10px;">‚ÑπÔ∏è</span>
                            <div>
                                <strong>Informaci√≥n del Sistema:</strong>
                                <p class="mb-0 mt-1">
                                    Este programa est√° registrado en el sistema SENA APP. Para ver informaci√≥n completa incluyendo competencias, perfil de egreso y requisitos de ingreso, haga clic en "Ver Detalles Completos".
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // Mostrar el modal
        const modal = new bootstrap.Modal(document.getElementById('modalDetalle'));
        modal.show();
    }
}

// Funcionalidad de b√∫squeda en tiempo real
function filtrarProgramas() {
    const input = document.getElementById('busquedaProgramas');
    const filter = input.value.toLowerCase();
    const table = document.querySelector('table tbody');
    const rows = table.getElementsByTagName('tr');

    for (let i = 0; i < rows.length; i++) {
        const cells = rows[i].getElementsByTagName('td');
        let found = false;
        
        for (let j = 0; j < cells.length; j++) {
            if (cells[j]) {
                const textValue = cells[j].textContent || cells[j].innerText;
                if (textValue.toLowerCase().indexOf(filter) > -1) {
                    found = true;
                    break;
                }
            }
        }
        
        rows[i].style.display = found ? '' : 'none';
    }
}

// Funcionalidad adicional para mejorar la experiencia del usuario
document.addEventListener('DOMContentLoaded', function() {
    // A√±adir efecto de carga a la tabla
    const table = document.querySelector('table');
    if (table) {
        table.style.opacity = '0';
        table.style.transform = 'translateY(20px)';
        table.style.transition = 'all 0.6s ease';
        
        setTimeout(() => {
            table.style.opacity = '1';
            table.style.transform = 'translateY(0)';
        }, 100);
    }
    
    // Mejorar la experiencia de hover en las filas
    const rows = document.querySelectorAll('tbody tr');
    rows.forEach(row => {
        row.addEventListener('mouseenter', function() {
            this.style.backgroundColor = 'rgba(0, 184, 148, 0.08)';
            this.style.borderLeft = '4px solid #00b894';
            this.style.paddingLeft = '8px';
        });
        
        row.addEventListener('mouseleave', function() {
            this.style.backgroundColor = '';
            this.style.borderLeft = '';
            this.style.paddingLeft = '';
        });
    });
});
</script>
{% endblock %}